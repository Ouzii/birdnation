(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{193:function(e,t,n){e.exports=n(502)},198:function(e,t,n){},221:function(e,t,n){},502:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(75),s=n.n(o),i=(n(198),n(3)),c=n.n(i),l=n(113),u=n(15),m=n(20),p=n(21),h=n(23),d=n(22),v=n(24),b=n(44),f=n.n(b),g="https://birdnation.herokuapp.com/api/observations";f.a.interceptors.request.use(function(e){return"post"!==e.method||navigator.onLine||window.dispatchEvent(new CustomEvent("axios",{detail:e})),e},function(e){return Promise.reject(e)});var E=function(){var e=Object(u.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get(g,{headers:{"Content-Type":"Application/json"}});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),w=function(){var e=Object(u.a)(c.a.mark(function e(t){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("".concat(g,"/").concat(t),{headers:{"Content-Type":"Application/json"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y={getAll:E,create:function(){var e=Object(u.a)(c.a.mark(function e(t){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post(g,t,{headers:{"Content-Type":"Application/json"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(u.a)(c.a.mark(function e(t){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.delete("".concat(g,"/").concat(t),{headers:{"Content-Type":"Application/json"}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getOne:w},k=(n(221),n(76)),O=n(51),x=n(504),j=n(506),C=n(111),S=n.n(C),N=function(e){if(S.a.isEmpty(e.toString())||S.a.isNumeric(e)||e.length>60)return"Observation has to be 1-60 characters long and must not be numeric"},D=function(e){if(e.length>600)return"Notes are too long, maximum character length is 600"},R=function(e){var t=[];t=t.concat(N(e.species),D(e.notes));var n=[];return t.forEach(function(e){e&&(n=n.concat(e))}),n},U=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).getCurrentPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){navigator.geolocation.getCurrentPosition(t,n,e)})},n.loadPosition=Object(u.a)(c.a.mark(function e(){var t,a,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getCurrentPosition();case 3:return t=e.sent,a=t.coords,r=a.latitude,o=a.longitude,e.abrupt("return",{latitude:r,longitude:o});case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),n.addObservation=function(){var e=Object(u.a)(c.a.mark(function e(t){var a,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,n.loadPosition();case 3:if(a=e.sent,r={species:n.state.species,rarity:n.state.rarity,notes:n.state.notes,latitude:a.latitude,longitude:a.longitude,time:new Date},!((o=R(r)).length>0)){e.next=10;break}return n.setState({errors:o}),setTimeout(function(){n.setState({errors:null})},4e3),e.abrupt("return");case 10:return e.next=12,y.create(r).then(function(e){return n.props.updateObservations(e)}).catch(function(e){console.log(e),n.props.updateObservations(Object(O.a)({id:Math.floor(Math.random()*Math.floor(1e3))},r))});case 12:n.setState({returnToIndex:!0});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.handleChange=function(e){n.setState(Object(k.a)({},e.target.name,e.target.value))},n.state={species:"",rarity:"Common",notes:"",returnToIndex:!1,errors:null},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return this.state.returnToIndex?r.a.createElement(x.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement(j.a,{to:"/"},"Cancel"),r.a.createElement("br",null),r.a.createElement("br",null),this.state.errors?r.a.createElement("div",null,this.state.errors.map(function(t){return r.a.createElement("div",{className:"alert alert-dismissible alert-danger",key:t},r.a.createElement("button",{type:"button",className:"close",onClick:function(){return e.setState({errors:null})}},"\xd7"),r.a.createElement("strong",null,t))})):r.a.createElement("div",null),r.a.createElement("form",{onSubmit:this.addObservation},r.a.createElement("label",null,"Species"),r.a.createElement("br",null),r.a.createElement("input",{name:"species",value:this.state.value,onChange:this.handleChange}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("label",null,"Rarity"),r.a.createElement("br",null),r.a.createElement("select",{name:"rarity",value:this.state.rarity,onChange:this.handleChange},r.a.createElement("option",{key:"Common",value:"Common"},"Common"),r.a.createElement("option",{key:"Rare",value:"Rare"},"Rare"),r.a.createElement("option",{key:"Extremely rare",value:"Extremely rare"},"Extremenly rare")),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("label",null,"Notes"),r.a.createElement("br",null),r.a.createElement("input",{type:"textarea",name:"notes",value:this.state.notes,onChange:this.handleChange}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"Submit"})))}}]),t}(r.a.Component),A=n(505),I=n(503),T=n(78),P=n(79),W=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={lat:parseFloat(n.props.lat),lng:parseFloat(n.props.lng)},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=Object(P.withGoogleMap)(function(t){return r.a.createElement(P.GoogleMap,{defaultCenter:e.state,defaultZoom:10,mark:!0},r.a.createElement(P.Marker,{position:e.state}))});return r.a.createElement("div",null,r.a.createElement(t,{containerElement:r.a.createElement("div",{style:{height:"250px",width:"250px",marginLeft:"auto",marginRight:"auto"}}),mapElement:r.a.createElement("div",{style:{height:"100%"}})}))}}]),t}(r.a.Component),L=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).resize=function(){n.setState(n.state)},n.state=Object(O.a)({},e.observation,{extended:!1}),n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"toggleExtended",value:function(){this.setState(Object(O.a)({},this.state,{extended:!this.state.extended}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.state.extended?r.a.createElement(T.Card,{className:"cardReact"},r.a.createElement("div",{onClick:function(){return e.toggleExtended()}},r.a.createElement("h4",null,this.state.species),r.a.createElement(T.CardBody,null,r.a.createElement("div",{onClick:function(){return e.toggleExtended()},style:{cursor:"pointer"}},"Rarity: ",this.state.rarity,r.a.createElement("br",null),"Location: ",this.state.latitude,", ",this.state.longitude,r.a.createElement("br",null),"Notes: ",this.state.notes,r.a.createElement("br",null),"Observed: ",new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"long",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(this.state.time)),r.a.createElement("br",null)))),r.a.createElement(W,{lat:this.state.latitude,lng:this.state.longitude})):r.a.createElement("div",{onClick:function(){return e.toggleExtended()}},r.a.createElement(T.Card,{className:"cardReact"},r.a.createElement("h4",null,this.state.species),r.a.createElement("p",null,this.state.rarity),r.a.createElement("br",null),this.state.notes.length>15?r.a.createElement("p",null,this.state.notes.substring(0,15),"..."):r.a.createElement("p",null,this.state.notes))))}}]),t}(r.a.Component),M=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={observations:n.props.observations,sortedBy:["time (newest)","time (oldest)","species","rarity"],sortNo:0},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.sortObservations()}},{key:"componentWillReceiveProps",value:function(e){this.props!==e&&this.setState({observations:e.observations})}},{key:"sortObservations",value:function(){var e=this.state.sortedBy[this.state.sortNo],t=this.state.observations;switch(e){case"time (newest)":t.sort(function(e,t){return new Date(e.time)>new Date(t.time)?-1:new Date(e.time)<new Date(t.time)?1:0});break;case"time (oldest)":t.sort(function(e,t){return new Date(e.time)<new Date(t.time)?-1:new Date(e.time)>new Date(t.time)?1:0});break;case"species":t.sort(function(e,t){return e.species.toString().toUpperCase()<t.species.toString().toUpperCase()?-1:e.species.toString().toUpperCase()>t.species.toString().toUpperCase()?1:0});break;case"rarity":t.sort(function(e,t){return e.rarity.toString().toUpperCase()<t.rarity.toString().toUpperCase()?-1:e.rarity.toString().toUpperCase()>t.rarity.toString().toUpperCase()?1:0})}this.setState({observations:t})}},{key:"changeSorting",value:function(){var e=Object(u.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.state.sortNo<3)){e.next=5;break}return e.next=3,this.setState({sortNo:this.state.sortNo+1});case 3:e.next=7;break;case 5:return e.next=7,this.setState({sortNo:0});case 7:this.sortObservations();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(j.a,{to:"/newobservation"},"New observation"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return e.changeSorting()}},"Sort by: ",this.state.sortedBy[this.state.sortNo]),r.a.createElement("br",null),r.a.createElement("br",null),this.state.observations.map(function(e){return r.a.createElement(L,{observation:e,key:e.id})}))}}]),t}(r.a.Component),B=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={observations:null},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("postCache")}},{key:"componentDidMount",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n,a=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("postCache",Object(u.a)(c.a.mark(function e(){var t,n,r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.observations){e.next=7;break}return t=a.state.observations,n=JSON.parse(window.localStorage.getItem("postedObs")),r=[].concat(Object(l.a)(n),Object(l.a)(t)),e.next=6,a.setState({observations:r});case 6:window.localStorage.removeItem("postedObs");case 7:case"end":return e.stop()}},e,this)}))),t=[],e.next=4,y.getAll().catch(function(e){return JSON.parse(window.localStorage.getItem("observations"))});case 4:if(t=e.sent,n=JSON.parse(window.localStorage.getItem("observations")),!(t!==n&&t.length>0)){e.next=12;break}return window.localStorage.setItem("observations",JSON.stringify(t)),e.next=10,this.setState({observations:t});case 10:e.next=19;break;case 12:if(!n){e.next=17;break}return e.next=15,this.setState({observations:n});case 15:e.next=19;break;case 17:return e.next=19,this.setState({observations:[]});case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateObservations",value:function(e){var t=this.state.observations;t.push(e),window.localStorage.setItem("observations",JSON.stringify(t)),this.setState({observations:t})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(A.a,null,r.a.createElement("div",null,r.a.createElement("h1",null,"Birdnation"),r.a.createElement("p",{className:"text-muted"},"Click the observations to expand them for more info!",r.a.createElement("br",null)," Reclicking the card (above map) minimizes them"),this.state.observations&&this.state.observations.length>0?r.a.createElement(I.a,{exact:!0,path:"/",render:function(){return r.a.createElement(M,{observations:e.state.observations,key:"listingpage"})}}):r.a.createElement(I.a,{exact:!0,path:"/",render:function(){return r.a.createElement("div",null,r.a.createElement(j.a,{to:"/newobservation"},"New observation"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("p",null,"No observations"))}}),r.a.createElement(I.a,{exact:!0,path:"/newobservation",render:function(){return r.a.createElement(U,{updateObservations:e.updateObservations.bind(e),key:"newobservation"})}}))))}}]),t}(r.a.Component),J=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}!function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");J?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):z(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):z(t,e)})}}(),s.a.render(r.a.createElement(B,null),document.getElementById("root"))}},[[193,2,1]]]);
//# sourceMappingURL=main.7396c706.chunk.js.map